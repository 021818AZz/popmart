<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<title>Login</title>
<meta name="description" content="" />
<meta name="keywords" content="" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="format-detection" content="telephone=no, email=no" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0" />
<script>
var docEl = document.documentElement;
docEl.style.fontSize = 100 / 375 * docEl.clientWidth  + 'px';
window.addEventListener('resize', function() {
  docEl.style.fontSize = 100 / 375 * docEl.clientWidth + 'px';
});
</script>
<link rel="stylesheet" href="https://www.adabr.com/css/antui-all.css"/>
<link rel="stylesheet" href="https://www.adabr.com/css/mobile/style.css"/>
<script type="text/javascript" src="https://www.adabr.com/js/jquery.min.js"></script>
<script type="text/javascript" src="https://www.adabr.com/js/layer/mobile/layer.js"></script>
<script type="text/javascript" src="https://www.adabr.com/js/common.js"></script>
<script type="text/javascript" src="https://www.adabr.com/js/mobile/public.js"></script>

<style>
.container .auth_bg{margin-top:33px;text-align:center;font-size:22px;font-weight:700}
.container .form{position:relative;top:28px;border-radius:20px 20px 0 0;width:100%;background-color:#fff}
.u-form-item{padding:5px 30px}
::placeholder{color: rgb(192, 196, 204);font-size:14px;}
.u-form-item .u-form-item__body,#register .u-form-item .u-form-item__body{padding:10px!important;background:#f2f7fb;border-radius:24px}
.u-form-item__body{display:flex;flex-direction:row;padding:10px 0}
.u-form-item__body__left{display:flex;flex-direction:row;align-items:center}
.u-form-item__body__left__content{position:relative;display:flex;flex-direction:row;align-items:center;padding-right:8px;flex:1}
.u-form-item__body__left__content__icon{margin-right:3px}
.u-form-item__body__right input{background-color:transparent;height:31px;display: block;width: 100%;outline: none;border: none;padding: 0;margin: 0;text-decoration: inherit;}
.container .btn{display:block;text-align:center;margin:10px 30px 10px 30px;color: #fff;background: linear-gradient(90deg,#05cda7,#00e763)!important;font-weight: 700;border-radius: 22px;padding:12px 0;font-size:16px;}
.container .forget{display:block;text-align:center;font-weight: 500;color: #00e763;font-size: 14px;text-align: center;margin-bottom: 20px;}
.container .form .btn-bottom{display:block;text-align:center;font-weight: 700;font-size:16px;width: 100%;text-align: center;margin-bottom:20px;color: #00e763;}
.guojia-list-item{padding:10px 0;border-bottom:1px #ddd dashed;}

/* Estilos adicionais para loading */
.loading-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 9999;
    justify-content: center;
    align-items: center;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #f3f3f3;
    border-top: 5px solid #00e763;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
</head>
<body ontouchstart="" style="background-color:#fff;background-image:url(https://i.postimg.cc/zDb2Jhw2/bg-top2.png);background-size:100% 260px;background-repeat:no-repeat;">

<div style="height:60px;"><div style="width:100%;height:59px;line-height:59px;position:fixed;top:0;left:0;z-index:999999;"><span style="position:absolute;right:10px;font-size:14px;color:#f73131;letter-spacing:1px;"><a target="_blank" href=" https://t.me/Ada8860"><img src="https://i.postimg.cc/CLvcSTY3/icon-kefu3.png" style="width:28px;height:28px;" /></a></span></div></div>

<div style="margin-top:45px;text-align:center;"><img src="https://i.postimg.cc/4dK8FWjD/logo.png" alt="logo" style="width:110px;height:110px;"></div>

<!-- Overlay de loading -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
</div>

<form id="myform" method="post" role="form" style="margin-top:50px;">
<div class="container">
    <div class="form">
        <div class="u-form">
            <div class="u-form-item">
                <div class="u-form-item__body" style="flex-direction: row;">
                    <div class="u-form-item__body__left">
                        <div class="u-form-item__body__left__content">
                            <div class="u-form-item__body__left__content__icon">
                                <div class="u-icon u-icon--right" style="display:flex;flex-direction: row;">
                                    <div class="u-icon__img" style="width:22px; height:22px;">
                                        <img src="https://i.postimg.cc/8Cq1Y0jW/shoujitubiao.png" style="display:block;width: 100%; height: 100%;">
                                    </div>
                                    <input id="area_codei" name="area_code" type="text" value="244" style="display:none;" required>
                                    <div style="width:40px;height:22px;" id="quhao" onclick="quhao_select()">+<span id="area_code">244</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="u-form-item__body__right">
                        <input id="user_name" name="user_name" autocomplete="off" type="text" maxlength="30" placeholder="Número de telefone" value="" autofocus="autofocus" required>
                    </div>
                </div>
            </div>
            <div class="u-form-item">
                <div class="u-form-item__body" style="flex-direction: row;">
                    <div class="u-form-item__body__left">
                        <div class="u-form-item__body__left__content">
                            <div class="u-form-item__body__left__content__icon">
                                <div class="u-icon u-icon--right">
                                    <div class="u-icon__img" style="width:22px; height:22px;">
                                        <img src="https://i.postimg.cc/tgm5GhjF/mima-d3ef0ce0.png" style="display:block;width: 100%; height: 100%;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="u-form-item__body__right">
                        <input value="" type="password" name="password" id="password" placeholder="Senha" required>
                    </div>
                </div>
            </div>
            <a href="javascript:dosubmit();" class="btn" id="loginBtn">
                Login
            </a>
            <a href="/register" class="btn-bottom">
                Cadastrar-se
            </a>
        </div>
    </div>
</div>
</form>

<script>
// Configuração da API
const API_BASE_URL = 'http://localhost:3000'; // Substitua pela URL real da sua API
const TOKEN_EXPIRY_HOURS = 5; // Token expira em 5 horas

// Função para seleção de código de área
function quhao_select() {
    layer.open({
        type: 1,
        content: '<div style="padding:0 10px;"><div style="height:200px;overflow-y:scroll;"><div class="guojia-list-item" onclick="qhselect(1)">(USA) +1</div><div class="guojia-list-item" onclick="qhselect(7)">(Russia) +7</div><div class="guojia-list-item" onclick="qhselect(20)">(Egypt) +20</div><div class="guojia-list-item" onclick="qhselect(27)">(South Africa) +27</div><div class="guojia-list-item" onclick="qhselect(30)">(Greece) +30</div><div class="guojia-list-item" onclick="qhselect(31)">(Netherlands) +31</div><div class="guojia-list-item" onclick="qhselect(32)">(Belgium) +32</div><div class="guojia-list-item" onclick="qhselect(33)">(France) +33</div><div class="guojia-list-item" onclick="qhselect(34)">(Spain) +34</div><div class="guojia-list-item" onclick="qhselect(39)">(Italy) +39</div><div class="guojia-list-item" onclick="qhselect(40)">(Romania) +40</div><div class="guojia-list-item" onclick="qhselect(41)">(Switzerland) +41</div><div class="guojia-list-item" onclick="qhselect(43)">(Austria) +43</div><div class="guojia-list-item" onclick="qhselect(44)">(United Kingdom) +44</div><div class="guojia-list-item" onclick="qhselect(45)">(Denmark) +45</div><div class="guojia-list-item" onclick="qhselect(46)">(Sweden) +46</div><div class="guojia-list-item" onclick="qhselect(47)">(Norway) +47</div><div class="guojia-list-item" onclick="qhselect(48)">(Poland) +48</div><div class="guojia-list-item" onclick="qhselect(49)">(Germany) +49</div><div class="guojia-list-item" onclick="qhselect(51)">(Peru) +51</div><div class="guojia-list-item" onclick="qhselect(52)">(Mexico) +52</div><div class="guojia-list-item" onclick="qhselect(53)">(Cuba) +53</div><div class="guojia-list-item" onclick="qhselect(54)">(Argentina) +54</div><div class="guojia-list-item" onclick="qhselect(55)">(Brazil) +55</div><div class="guojia-list-item" onclick="qhselect(56)">(Chile) +56</div><div class="guojia-list-item" onclick="qhselect(57)">(Colombia) +57</div><div class="guojia-list-item" onclick="qhselect(58)">(Venezuela) +58</div><div class="guojia-list-item" onclick="qhselect(60)">(Malaysia) +60</div><div class="guojia-list-item" onclick="qhselect(61)">(Australia) +61</div><div class="guojia-list-item" onclick="qhselect(62)">(Indonesia) +62</div><div class="guojia-list-item" onclick="qhselect(63)">(Philippines) +63</div><div class="guojia-list-item" onclick="qhselect(64)">(New Zealand) +64</div><div class="guojia-list-item" onclick="qhselect(65)">(Singapore) +65</div><div class="guojia-list-item" onclick="qhselect(66)">(Thailand) +66</div><div class="guojia-list-item" onclick="qhselect(81)">(Japan) +81</div><div class="guojia-list-item" onclick="qhselect(82)">(South Korea) +82</div><div class="guojia-list-item" onclick="qhselect(84)">(Vietnam) +84</div><div class="guojia-list-item" onclick="qhselect(86)">(China) +86</div><div class="guojia-list-item" onclick="qhselect(90)">(Turkey) +90</div><div class="guojia-list-item" onclick="qhselect(91)">(India) +91</div><div class="guojia-list-item" onclick="qhselect(92)">(Pakistan) +92</div><div class="guojia-list-item" onclick="qhselect(93)">(Afghanistan) +93</div><div class="guojia-list-item" onclick="qhselect(94)">(Sri Lanka) +94</div><div class="guojia-list-item" onclick="qhselect(95)">(Myanmar) +95</div><div class="guojia-list-item" onclick="qhselect(98)">(Iran) +98</div><div class="guojia-list-item" onclick="qhselect(213)">(Algeria) +213</div><div class="guojia-list-item" onclick="qhselect(216)">(Tunisia) +216</div><div class="guojia-list-item" onclick="qhselect(218)">(Libya) +218</div><div class="guojia-list-item" onclick="qhselect(220)">(Gambia) +220</div><div class="guojia-list-item" onclick="qhselect(221)">(Senegal) +221</div><div class="guojia-list-item" onclick="qhselect(222)">(Mauritania) +222</div><div class="guojia-list-item" onclick="qhselect(223)">(Mali) +223</div><div class="guojia-list-item" onclick="qhselect(224)">(Guinea) +224</div><div class="guojia-list-item" onclick="qhselect(225)">(Côte d\'Ivoire) +225</div><div class="guojia-list-item" onclick="qhselect(226)">(Burkina Faso) +226</div><div class="guojia-list-item" onclick="qhselect(227)">(Niger) +227</div><div class="guojia-list-item" onclick="qhselect(228)">(Togo) +228</div><div class="guojia-list-item" onclick="qhselect(229)">(Benin) +229</div><div class="guojia-list-item" onclick="qhselect(230)">(Mauritius) +230</div><div class="guojia-list-item" onclick="qhselect(231)">(Liberia) +231</div><div class="guojia-list-item" onclick="qhselect(232)">(Sierra Leone) +232</div><div class="guojia-list-item" onclick="qhselect(233)">(Ghana) +233</div><div class="guojia-list-item" onclick="qhselect(234)">(Nigeria) +234</div><div class="guojia-list-item" onclick="qhselect(235)">(Chad) +235</div><div class="guojia-list-item" onclick="qhselect(237)">(Cameroon) +237</div><div class="guojia-list-item" onclick="qhselect(238)">(Cape Verde) +238</div><div class="guojia-list-item" onclick="qhselect(974)">(Qatar) +974</div><div class="guojia-list-item" onclick="qhselect(994)">(Azerbaijan) +994</div></div></div>',
        anim: 'up',
        style: 'position:fixed; bottom:0; left:0; width: 100%; height: 200px; padding:10px 0; border:none;'
    });
}

function qhselect(quhao) {
    quhao = quhao || $("#quhaose").val();
    $("#area_code").html(quhao);
    $("#area_codei").val(quhao);
    layer.closeAll();
}

// Função para mostrar/ocultar loading
function showLoading(show) {
    const loadingOverlay = document.getElementById('loadingOverlay');
    if (loadingOverlay) {
        loadingOverlay.style.display = show ? 'flex' : 'none';
    } else if (show) {
        // Criar overlay de loading se não existir
        const overlay = document.createElement('div');
        overlay.id = 'loadingOverlay';
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        `;
        overlay.innerHTML = `
            <div style="background: white; padding: 20px; border-radius: 8px;">
                <p>Carregando...</p>
            </div>
        `;
        document.body.appendChild(overlay);
    }
}

// Função principal de login
async function dosubmit() {
    const areaCode = $("#area_code").html();
    const user_name = $("#user_name").val();
    const password = $("#password").val();
    
    // Validações
    if (!user_name) {
        layer.open({
            content: 'Digite o número de telefone',
            skin: 'msg',
            time: 2
        });
        return false;
    }
    
    if (!password) {
        layer.open({
            content: 'Digite a senha',
            skin: 'msg',
            time: 2
        });
        return false;
    }

    // Combinar código do país com número de telefone
    const mobile = areaCode + user_name;

    showLoading(true);

    try {
        // Fazer requisição para a API de login
        const response = await fetch(`${API_BASE_URL}/login`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                mobile: mobile,
                password: password
            })
        });

        const data = await response.json();

        if (data.success) {
            // Login bem-sucedido - Armazenar no localStorage com expiração
            const tokenData = {
                token: data.data.token,
                expiry: Date.now() + (TOKEN_EXPIRY_HOURS * 60 * 60 * 1000) // 5 horas a partir de agora
            };
            
            // Salvar no localStorage (sem cookies)
            localStorage.setItem('user_token', JSON.stringify(tokenData));
            localStorage.setItem('user_mobile', user_name);
            localStorage.setItem('user_id', data.data.user.id);
            
            layer.open({
                content: 'Login realizado com sucesso!',
                skin: 'msg',
                time: 2,
                end: function() {
                    // Redirecionar para a página principal/dashboard
                    window.location.href = '/dashboard.html';
                }
            });
        } else {
            layer.open({
                content: data.message || 'Erro ao fazer login',
                skin: 'msg',
                time: 3
            });
        }
    } catch (error) {
        console.error('Erro no login:', error);
        layer.open({
            content: 'Erro de conexão com o servidor',
            skin: 'msg',
            time: 3
        });
    } finally {
        showLoading(false);
    }
}

// Função para verificar se o token no localStorage ainda é válido
function isTokenValid() {
    const tokenData = localStorage.getItem('user_token');
    
    if (!tokenData) return false;
    
    try {
        const { token, expiry } = JSON.parse(tokenData);
        
        // Verificar se o token expirou
        if (Date.now() > expiry) {
            // Token expirado, remover do localStorage
            localStorage.removeItem('user_token');
            localStorage.removeItem('user_mobile');
            localStorage.removeItem('user_id');
            return false;
        }
        
        return true;
    } catch (e) {
        console.error('Erro ao verificar token:', e);
        return false;
    }
}

// Verificar se já está logado ao carregar a página
document.addEventListener('DOMContentLoaded', function() {
    // Carregar número salvo se existir
    const savedMobile = localStorage.getItem('user_mobile');
    if (savedMobile && document.getElementById('user_name')) {
        document.getElementById('user_name').value = savedMobile;
    }
    
    // Verificar se há token válido no localStorage
    if (isTokenValid()) {
        // Se já tem token válido, redirecionar para dashboard
        window.location.href = '/dashboard.html';
    }
    
    // Tecla Enter para submeter o formulário (apenas se o campo existir)
    const passwordField = document.getElementById('password');
    if (passwordField) {
        passwordField.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                dosubmit();
            }
        });
    }
});
</script>
<body>
    
