<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=0,initial-scale=1,maximum-scale=1, minimum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>Minha Equipe</title>
    <link href="https://popmbbb.cc/Lay/css/layui.css?v1.6" rel="stylesheet" />
    <link href="https://popmbbb.cc/css/main.css?v2.7" rel="stylesheet" />
    <link href="https://popmbbb.cc/layer_mobile/need/layer.css?v1.6" rel="stylesheet" />
    <script src="https://popmbbb.cc/Lay/layui.js?v1.6"></script>
    <script src="https://popmbbb.cc/js/comm.js?v1.6"></script>
    <script src="https://popmbbb.cc/js/clipboard.min.js"></script>
    <style type="text/css">
        /* Estilos gerais */
        body {
            min-height: 100%; 
            width: 100%; 
            background: #f1f1f1;
            font-family: 'HarmonyOS Sans SC', sans-serif;
        }
        
        /* Estilo para loading */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(0,0,0,.3);
            border-radius: 50%;
            border-top-color: #000;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Estilo para valores monetários */
        .currency-value {
            font-weight: bold;
            color: #28a745;
        }
        
        .team-header {
            background: #28a745; 
            color: white;
            padding: 15px;
            position: relative;
            border-radius: 0 0 15px 15px;
        }
        
        .team-level {
            background: white;
            border-radius: 15px;
            margin: 10px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .team-level:before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: #28a745;
        }
        
        .invite-section {
            background: linear-gradient(135deg, #28a745, #5cb85c);
            border-radius: 15px;
            margin: 10px;
            padding: 15px;
            color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .copy-btn {
            background: white;
            color: #28a745;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .stats-card {
            background: white;
            border-radius: 15px;
            margin: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        .level-icon {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        .level-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        /* Outros estilos existentes mantidos */
        .top1 {
            position: fixed;
            background: #fff;
            z-index: 10000;
            width: 100%;
            height: 30px;
            top: -30px;
        }
        
        .nav {
            background-size:100% 100%; 
            height:60px;
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 450px;
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            border-radius: 15px 15px 0 0;
        }
        
        .navtab {
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
        }
        
        .navtab.active {
            color: #28a745;
        }
        
        .gray {
            filter: grayscale(100%);
        }
        
        .rule-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .rule-icon {
            margin-right: 8px;
            min-width: 20px;
            color: #28a745;
        }
    </style>
</head>
<body>
    <input id="site_http" type="hidden" value="" />
    
    <div style="max-width:450px; margin:0 auto; padding-bottom: 70px;">
        <div class="top1"></div>
        
        <!-- Cabeçalho -->
        <div class="team-header">
            <div style="font-size: 18px; font-weight: bold; display: flex; align-items: center;">
                <svg class="icon" viewBox="0 0 24 24" fill="white">
                    <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" />
                </svg>
                Minha Equipe
            </div>
            <div style="font-size: 12px; margin-top: 5px; display: flex; align-items: center;">
                <svg class="icon" viewBox="0 0 24 24" fill="white" style="width: 16px; height: 16px;">
                    <path d="M10,17L5,12L6.41,10.58L10,14.17L17.59,6.58L19,8M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" />
                </svg>
                Convide amigos para ganhar dinheiro
            </div>
            <div id="teamdetails" style="position:absolute; right:15px; top:15px; background: white; color: #28a745; padding: 5px 10px; border-radius: 20px; font-size: 12px; display: flex; align-items: center;">
                <svg style="width: 14px; height: 14px; margin-right: 5px;" viewBox="0 0 24 24" fill="#28a745">
                    <path d="M9,18V10L15,14L9,18M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2Z" />
                </svg>
                Detalhes
            </div>
        </div>
        
        <!-- Níveis da Equipe -->
        <div style="margin-top: 10px;">
            <div class="team-level">
                <div class="level-header">
                    <svg class="level-icon" viewBox="0 0 24 24" fill="#28a745">
                        <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z" />
                    </svg>
                    <div style="font-weight: bold; font-size: 18px; color: #28a745;">Nível 1</div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                    <div>
                        <div style="font-size: 12px; color: #666; display: flex; align-items: center;">
                            <svg style="width: 14px; height: 14px; margin-right: 5px;" viewBox="0 0 24 24" fill="#666">
                                <path d="M11,15H13V17H11V15M11,7H13V13H11V7M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z" />
                            </svg>
                            Taxa de comissão
                        </div>
                        <div id="P1" class="currency-value"><span class="loading"></span></div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #666; display: flex; align-items: center;">
                            <svg style="width: 14px; height: 14px; margin-right: 5px;" viewBox="0 0 24 24" fill="#666">
                                <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" />
                            </svg>
                            Membros
                        </div>
                        <div id="task1_count" class="currency-value"><span class="loading"></span></div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #666; display: flex; align-items: center;">
                            <svg style="width: 14px; height: 14px; margin-right: 5px;" viewBox="0 0 24 24" fill="#666">
                                <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,11.99H19V11C19,7.9 16.97,5.17 14,4.27V7H10V4.27C7.03,5.17 5,7.9 5,11V12H12V15.99L15,13L12,11.99Z" />
                            </svg>
                            Comissão
                        </div>
                        <div id="lv1_team_income" class="currency-value"><span class="loading"></span></div>
                    </div>
                </div>
            </div>
            
            <div class="team-level">
                <div class="level-header">
                    <svg class="level-icon" viewBox="0 0 24 24" fill="#28a745">
                        <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z" />
                    </svg>
                    <div style="font-weight: bold; font-size: 18px; color: #28a745;">Nível 2</div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                    <div>
                        <div style="font-size: 12px; color: #666; display: flex; align-items: center;">
                            <svg style="width: 14px; height: 14px; margin-right: 5px;" viewBox="0 0 24 24" fill="#666">
                                <path d="M11,15H13V17H11V15M11,7H13V13H11V7M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z" />
                            </svg>
                            Taxa de comissão
                        </div>
                        <div id="P2" class="currency-value"><span class="loading"></span></div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #666; display: flex; align-items: center;">
                            <svg style="width: 14px; height: 14px; margin-right: 5px;" viewBox="0 0 24 24" fill="#666">
                                <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" />
                            </svg>
                            Membros
                        </div>
                        <div id="task2_count" class="currency-value"><span class="loading"></span></div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #666; display: flex; align-items: center;">
                            <svg style="width: 14px; height: 14px; margin-right: 5px;" viewBox="0 0 24 24" fill="#666">
                                <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,11.99H19V11C19,7.9 16.97,5.17 14,4.27V7H10V4.27C7.03,5.17 5,7.9 5,11V12H12V15.99L15,13L12,11.99Z" />
                            </svg>
                            Comissão
                        </div>
                        <div id="lv2_team_income" class="currency-value"><span class="loading"></span></div>
                    </div>
                </div>
            </div>
            
            <div class="team-level">
                <div class="level-header">
                    <svg class="level-icon" viewBox="0 0 24 24" fill="#28a745">
                        <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z" />
                    </svg>
                    <div style="font-weight: bold; font-size: 18px; color: #28a745;">Nível 3</div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                    <div>
                        <div style="font-size: 12px; color: #666; display: flex; align-items: center;">
                            <svg style="width: 14px; height: 14px; margin-right: 5px;" viewBox="0 0 24 24" fill="#666">
                                <path d="M11,15H13V17H11V15M11,7H13V13H11V7M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z" />
                            </svg>
                            Taxa de comissão
                        </div>
                        <div id="P3" class="currency-value"><span class="loading"></span></div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #666; display: flex; align-items: center;">
                            <svg style="width: 14px; height: 14px; margin-right: 5px;" viewBox="0 0 24 24" fill="#666">
                                <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" />
                            </svg>
                            Membros
                        </div>
                        <div id="task3_count" class="currency-value"><span class="loading"></span></div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #666; display: flex; align-items: center;">
                            <svg style="width: 14px; height: 14px; margin-right: 5px;" viewBox="0 0 24 24" fill="#666">
                                <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,11.99H19V11C19,7.9 16.97,5.17 14,4.27V7H10V4.27C7.03,5.17 5,7.9 5,11V12H12V15.99L15,13L12,11.99Z" />
                            </svg>
                            Comissão
                        </div>
                        <div id="lv3_team_income" class="currency-value"><span class="loading"></span></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Convite -->
        <div class="invite-section">
            <div style="font-weight: bold; margin-bottom: 10px; display: flex; align-items: center;">
                <svg class="icon" viewBox="0 0 24 24" fill="white" style="margin-right: 8px;">
                    <path d="M19,3H14.82C14.4,1.84 13.3,1 12,1C10.7,1 9.6,1.84 9.18,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M12,3A1,1 0 0,1 13,4A1,1 0 0,1 12,5A1,1 0 0,1 11,4A1,1 0 0,1 12,3M13,12H16L12,7L8,12H11V16H13V12Z" />
                </svg>
                Convite
            </div>
            
            <div style="margin-bottom: 15px;">
                <div style="font-size: 12px; display: flex; align-items: center;">
                    <svg style="width: 16px; height: 16px; margin-right: 5px;" viewBox="0 0 24 24" fill="white">
                        <path d="M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V5H19V19M17,8H15.5C15.5,6.07 13.93,4.5 12,4.5C10.07,4.5 8.5,6.07 8.5,8H7V16H17V8M12,6.5A1.5,1.5 0 0,1 13.5,8H10.5A1.5,1.5 0 0,1 12,6.5Z" />
                    </svg>
                    Código de convite
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                    <div id="invitation" style="font-weight: bold; font-size: 18px; letter-spacing: 2px;"><span class="loading"></span></div>
                    <button id="copy1" class="copy-btn">
                        <svg style="width: 16px; height: 16px;" viewBox="0 0 24 24" fill="#28a745">
                            <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" />
                        </svg>
                        Copiar
                    </button>
                </div>
            </div>
            
            <div>
                <div style="font-size: 12px; display: flex; align-items: center;">
                    <svg style="width: 16px; height: 16px; margin-right: 5px;" viewBox="0 0 24 24" fill="white">
                        <path d="M3.9,12C3.9,10.29 5.29,8.9 7,8.9H11V7H7A5,5 0 0,0 2,12A5,5 0 0,0 7,17H11V15.1H7C5.29,15.1 3.9,13.71 3.9,12M8,13H16V11H8V13M17,7H13V8.9H17C18.71,8.9 20.1,10.29 20.1,12C20.1,13.71 18.71,15.1 17,15.1H13V17H17A5,5 0 0,0 22,12A5,5 0 0,0 17,7Z" />
                    </svg>
                    Link de convite
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                    <div id="link" style="font-size: 12px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 70%;"><span class="loading"></span></div>
                    <button id="copy" class="copy-btn">
                        <svg style="width: 16px; height: 16px;" viewBox="0 0 24 24" fill="#28a745">
                            <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" />
                        </svg>
                        Copiar
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Estatísticas -->
        <div style="display: flex; justify-content: space-between; margin-top: 15px;">
            <div class="stats-card" style="width: 48%;">
                <svg style="width: 32px; height: 32px; margin-bottom: 5px;" viewBox="0 0 24 24" fill="#28a745">
                    <path d="M16,13C15.71,13 15.38,13 15.03,13.05C16.19,13.89 17,15 17,16.5V19H23V16.5C23,14.17 18.33,13 16,13M8,13C5.67,13 1,14.17 1,16.5V19H15V16.5C15,14.17 10.33,13 8,13M8,11A3,3 0 0,0 11,8A3,3 0 0,0 8,5A3,3 0 0,0 5,8A3,3 0 0,0 8,11M16,11A3,3 0 0,0 19,8A3,3 0 0,0 16,5A3,3 0 0,0 13,8A3,3 0 0,0 16,11Z" />
                </svg>
                <div style="font-size: 12px; color: #666;">Total de Membros</div>
                <div id="t1" style="font-weight: bold; font-size: 18px; margin-top: 5px;"><span class="loading"></span></div>
            </div>
            <div class="stats-card" style="width: 48%;">
                <svg style="width: 32px; height: 32px; margin-bottom: 5px;" viewBox="0 0 24 24" fill="#28a745">
                    <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.1 14.8,9.5V11C15.4,11 16,11.6 16,12.3V15.8C16,16.4 15.4,17 14.7,17H9.2C8.6,17 8,16.4 8,15.7V12.2C8,11.6 8.6,11 9.2,11V9.5C9.2,8.1 10.6,7 12,7M12,8.2C11.2,8.2 10.5,8.7 10.5,9.5V11H13.5V9.5C13.5,8.7 12.8,8.2 12,8.2Z" />
                </svg>
                <div style="font-size: 12px; color: #666;">Comissão Total</div>
                <div id="t2" style="font-weight: bold; font-size: 18px; margin-top: 5px;"><span class="loading"></span></div>
            </div>
        </div>
        
        <!-- Regras -->
        <div class="team-level" style="margin-top: 15px;">
            <div style="font-weight: bold; margin-bottom: 10px; display: flex; align-items: center;">
                <svg class="icon" viewBox="0 0 24 24" fill="#28a745" style="margin-right: 8px;">
                    <path d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z" />
                </svg>
                Regras da Equipe
            </div>
            <div style="font-size: 12px; color: #666; line-height: 1.5;">
                <p>Quando seus amigos convidados se cadastrarem e investirem:</p>
                <div class="rule-item">
                    <div class="rule-icon">✓</div>
                    <div>Você recebe 20% de cashback dos membros do Nível 1</div>
                </div>
                <div class="rule-item">
                    <div class="rule-icon">✓</div>
                    <div>Você recebe 8% de cashback dos membros do Nível 2</div>
                </div>
                <div class="rule-item">
                    <div class="rule-icon">✓</div>
                    <div>Você recebe 2% de cashback dos membros do Nível 3</div>
                </div>
                <p style="margin-top: 10px; display: flex; align-items: center;">
                    <svg style="width: 16px; height: 16px; margin-right: 5px;" viewBox="0 0 24 24" fill="#28a745">
                        <path d="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" />
                    </svg>
                    As recompensas são creditadas imediatamente e podem ser sacadas a qualquer momento.
                </p>
            </div>
        </div>
    </div>
    
    <!-- Navegação -->
    <nav class="nav">
        <div url="meu.html" class="navtab">
            <img src="https://popmbbb.cc/ui2/nav/11.png" class="gray" style="height: 32px;" /><br>
            <span>Lar</span>
        </div>
        <div url="produto.html" class="navtab">
            <img src="https://popmbbb.cc/ui2/nav/22.png" class="gray" style="height: 28px;" /><br>
            <span>Produto</span>
        </div>
        <div style="color: #28a745 !important; font-weight: bold;">
            <img src="https://popmbbb.cc/ui2/nav/3.png" style="height:28px;" /><br>
            <span>Equipe</span>
        </div>
        <div url="meu.html" class="navtab">
            <img src="https://popmbbb.cc/ui2/nav/44.png" class="gray" style="height: 28px;" /><br>
            <span>Meu</span>
        </div>
    </nav>

    <script>// Função para formatar valores em KZ (Kwanza Angolano)
function formatCurrency(value) {
    if (isNaN(value)) value = 0;
    return 'KZ ' + parseFloat(value).toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

// Função para mostrar/ocultar o loading overlay
function toggleLoading(show) {
    const overlay = document.getElementById('loading-overlay');
    if (overlay) {
        overlay.style.display = show ? 'flex' : 'none';
    }
}

// Função principal para buscar dados da equipe
async function fetchTeamData() {
    const token = localStorage.getItem('token');
    if (!token) {
        window.location.href = '/index.html';
        return;
    }

    // Mostrar loading states
    document.querySelectorAll('.currency-value').forEach(el => {
        el.innerHTML = '<span class="loading"></span>';
    });
    toggleLoading(true);

    try {
        // Fazer requisições em paralelo
        const [userResponse, teamResponse] = await Promise.all([
            fetch('https://bd-1-tile.onrender.com/me', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token,
                    'Cache-Control': 'no-cache'
                }
            }),
            fetch('https://bd-uopv.onrender.com/user/team', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token,
                    'Cache-Control': 'no-cache'
                }
            })
        ]);

        if (!userResponse.ok || !teamResponse.ok) {
            throw new Error('Erro na rede');
        }

        const [userData, teamData] = await Promise.all([
            userResponse.json(),
            teamResponse.json()
        ]);

        if (userData.success) {
            const user = userData.user;

            // Atualizar dados de convite
            document.getElementById('invitation').textContent = user.codigoConvite || 'N/A';
            const siteUrl = userData.site_http || 'http://popmtr.org';
            const inviteLink = `${siteUrl}/registro.html?a=${user.codigoConvite}`;
            document.getElementById('link').textContent = inviteLink;

            // Configurar botões de cópia
            setupClipboardButtons(user.codigoConvite, inviteLink);

            if (teamData.success) {
                updateTeamData(teamData, userData);
            } else {
                throw new Error(teamData.mensagem || 'Erro ao carregar equipe');
            }
        }
    } catch (error) {
        console.error('Erro:', error);
        showErrorToast('Erro ao carregar dados da equipe');
    } finally {
        toggleLoading(false);
    }
}

// Configurar botões de cópia
function setupClipboardButtons(inviteCode, inviteLink) {
    // Botão de copiar link
    const clipboard1 = new ClipboardJS('#copy', {
        text: () => inviteLink
    });
    
    clipboard1.on('success', () => showSuccessToast('Link copiado com sucesso!'));
    clipboard1.on('error', () => showErrorToast('Erro ao copiar link.'));

    // Botão de copiar código
    const clipboard2 = new ClipboardJS('#copy1', {
        text: () => inviteCode || ''
    });
    
    clipboard2.on('success', () => showSuccessToast('Código copiado com sucesso!'));
    clipboard2.on('error', () => showErrorToast('Erro ao copiar código.'));
}

// Atualizar os dados da equipe na interface
function updateTeamData(teamData, userData) {
    const level1 = teamData.level1 || [];
    const level2 = teamData.level2 || [];
    const level3 = teamData.level3 || [];

    // Atualizar taxas de comissão
    document.getElementById('P1').textContent = '20%';
    document.getElementById('P2').textContent = '8%';
    document.getElementById('P3').textContent = '2%';

    // Atualizar contagem de membros
    document.getElementById('task1_count').textContent = level1.length;
    document.getElementById('task2_count').textContent = level2.length;
    document.getElementById('task3_count').textContent = level3.length;

    // Atualizar totais
    const totalMembers = level1.length + level2.length + level3.length;
    document.getElementById('t1').textContent = totalMembers;
    document.getElementById('t2').textContent = formatCurrency(userData.totals?.teamCommissions || 0);

    // Calcular e atualizar comissões
    document.getElementById('lv1_team_income').textContent = formatCurrency(
        teamData.commissions?.level1 || sumCommission(level1)
    );
    document.getElementById('lv2_team_income').textContent = formatCurrency(
        teamData.commissions?.level2 || sumCommission(level2)
    );
    document.getElementById('lv3_team_income').textContent = formatCurrency(
        teamData.commissions?.level3 || sumCommission(level3)
    );
}

// Função auxiliar para somar comissões
function sumCommission(list) {
    return list.reduce((sum, u) => {
        const valor = Number(u.comissao ?? u.commission ?? 0);
        return sum + (isNaN(valor) ? 0 : valor);
    }, 0);
}

// Funções de feedback para o usuário
function showSuccessToast(message) {
    if (typeof layer !== 'undefined') {
        layer.msg(message, { icon: 1 });
    } else {
        alert(message);
    }
}

function showErrorToast(message) {
    if (typeof layer !== 'undefined') {
        layer.msg(message, { icon: 2 });
    } else {
        alert(message);
    }
}

// Inicialização quando o DOM estiver pronto
document.addEventListener('DOMContentLoaded', function() {
    // Verificar autenticação
    if (!localStorage.getItem('token')) {
        window.location.href = '/index.html';
        return;
    }

    // Configurar navegação
    setupNavigation();

    // Carregar dados inicialmente
    fetchTeamData();
    
    // Atualizar a cada 30 segundos
    setInterval(fetchTeamData, 30000);
});

// Configurar eventos de navegação
function setupNavigation() {
    if (typeof $ !== 'undefined') {
        $(document).on("click", '#teamdetails', function() {
            layer.open({
                type: 2,
                title: false,
                area: ['100%', '100%'],
                shadeClose: true,
                content: "/main/teaminfo.html?time=" + Math.random()
            });
        });

        $(document).on("click", '.navtab', function() {
            const url = $(this).attr("url");
            if (url) location.href = url + "?time=" + Math.random();
        });
    }
}

// Adicionar overlay de loading dinamicamente se não existir
if (!document.getElementById('loading-overlay')) {
    const overlay = document.createElement('div');
    overlay.id = 'loading-overlay';
    overlay.style.cssText = 'display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; justify-content: center; align-items: center;';
    overlay.innerHTML = `
        <div style="background: white; padding: 20px; border-radius: 10px; text-align: center;">
            <div class="loading" style="width: 40px; height: 40px; border-width: 4px;"></div>
            <div style="margin-top: 10px;">Carregando dados da equipe...</div>
        </div>
    `;
    document.body.appendChild(overlay);
}
</script>
</body>
</html>