<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Depósito - Royal Bank Angola</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .animate-slide-up {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .animate-fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        .compact-modal {
            max-height: 85vh;
            overflow-y: auto;
            width: 95%;
            max-width: 500px;
        }
        
        .compact-modal-content {
            padding: 1rem;
        }

        /* Estilo para a barra de rolagem */
        .compact-modal::-webkit-scrollbar {
            width: 5px;
        }
        
        .compact-modal::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .compact-modal::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        .compact-modal::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Estilos para as bolas de futebol */
        .football-ball {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            cursor: pointer;
            transition: all 0.5s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 10;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            border: 3px solid #15803d;
            overflow: hidden;
        }

        .football-ball::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                /* Linhas pretas do futebol */
                linear-gradient(to right, #000 0%, #000 5%, transparent 5%, transparent 95%, #000 95%, #000 100%),
                linear-gradient(to bottom, #000 0%, #000 5%, transparent 5%, transparent 95%, #000 95%, #000 100%),
                /* Pentágonos pretos */
                radial-gradient(circle at 30% 30%, #000 0%, #000 10%, transparent 10%),
                radial-gradient(circle at 70% 30%, #000 0%, #000 10%, transparent 10%),
                radial-gradient(circle at 50% 70%, #000 0%, #000 10%, transparent 10%),
                radial-gradient(circle at 20% 50%, #000 0%, #000 10%, transparent 10%),
                radial-gradient(circle at 80% 50%, #000 0%, #000 10%, transparent 10%);
            background-size: 
                100% 100%,
                100% 100%,
                100% 100%,
                100% 100%,
                100% 100%,
                100% 100%,
                100% 100%;
            background-repeat: no-repeat;
            opacity: 0.7;
        }

        .football-ball.selected {
            border: 3px solid #fbbf24;
            box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.5);
            transform: scale(1.1);
        }

        .ball-content {
            position: relative;
            z-index: 2;
            text-align: center;
            color: #15803d;
            font-weight: bold;
            font-size: 12px;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
            padding: 0 5px;
        }

        .football-container {
            position: relative;
            width: 100%;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }

        .bank-info-display {
            background: #f8fafc;
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid #e2e8f0;
            text-align: center;
        }

        .bank-name-display {
            font-size: 18px;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .bank-desc-display {
            font-size: 14px;
            color: #64748b;
        }

        .confirm-button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #15803d 0%, #16a34a 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .confirm-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(21, 128, 61, 0.3);
        }

        .confirm-button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Loading elegante */
        .loading {
            display: none;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mensagens de status */
        .success-message {
            background: rgba(34, 197, 94, 0.2);
            color: #16a34a;
            padding: 1.2rem;
            border-radius: 0.9rem;
            margin: 1.5rem 0;
            text-align: center;
            border: 1px solid rgba(22, 163, 74, 0.3);
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            color: #dc2626;
            padding: 1.2rem;
            border-radius: 0.9rem;
            margin: 1.5rem 0;
            text-align: center;
            border: 1px solid rgba(220, 38, 38, 0.3);
        }

        /* Estilos para a tela de informações bancárias */
        .bank-details-screen {
            display: none;
        }

        .bank-details-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 500;
            color: #64748b;
        }

    .detail-value {
      font-weight: 600;
      color: #1e293b;
    }

    .copy-btn {
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 12px;
      cursor: pointer;
      margin-left: 10px;
    }

    .copy-btn:hover {
      background: #2563eb;
    }

    .receipt-upload-area {
      border: 2px dashed #cbd5e1;
      border-radius: 8px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #f8fafc;
    }

    .receipt-upload-area:hover {
      border-color: #3b82f6;
      background: #f0f9ff;
    }

    .receipt-preview {
      max-width: 100%;
      max-height: 200px;
      margin-top: 15px;
      border-radius: 8px;
      display: none;
    }

    .back-button {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #f1f5f9;
      border: none;
      border-radius: 8px;
      padding: 10px 15px;
      cursor: pointer;
      font-weight: 500;
      margin-bottom: 20px;
      transition: all 0.3s ease;
    }

    .back-button:hover {
      background: #e2e8f0;
    }

    /* NOVOS ESTILOS PARA TEMA DE FUTEBOL */
    .grass-background {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 50%, #15803d 100%);
      position: relative;
      overflow: hidden;
    }

    .grass-background::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        linear-gradient(90deg, transparent 79%, rgba(255,255,255,0.1) 80%, transparent 81%),
        linear-gradient(transparent 79%, rgba(255,255,255,0.1) 80%, transparent 81%);
      background-size: 40px 40px;
      pointer-events: none;
    }

    .football-field {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 50%, #15803d 100%);
      border: 2px solid #ffffff;
      border-radius: 12px;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    .football-field::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        linear-gradient(90deg, transparent 49%, rgba(255,255,255,0.3) 50%, transparent 51%),
        linear-gradient(transparent 49%, rgba(255,255,255,0.3) 50%, transparent 51%);
      background-size: 30px 30px;
      pointer-events: none;
    }

    .bank-info-grass {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      border: 2px solid white;
      border-radius: 12px;
      padding: 20px;
      color: white;
      text-align: center;
      margin: 15px 0;
      position: relative;
      overflow: hidden;
    }

    .bank-info-grass::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(255,255,255,0.1) 0%, transparent 20%),
        radial-gradient(circle at 80% 70%, rgba(255,255,255,0.1) 0%, transparent 20%);
      pointer-events: none;
    }

    .grass-button {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      color: white;
      border: 2px solid white;
      border-radius: 8px;
      padding: 12px 20px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .grass-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
      background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
    }

    .white-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border: 1px solid #e2e8f0;
    }

    .green-text {
      color: #15803d;
    }

    .white-text {
      color: white;
    }
  </style>
</head>

<body class="bg-green-50 text-neutral-900 min-h-screen font-sans">
  <div class="max-w-md mx-auto pb-24">
    <!-- Header -->
    <header class="grass-background shadow-sm sticky top-0 z-40 flex items-center justify-between px-5 py-4 border-b border-green-600">
      <button onclick="history.back()" class="text-slate-500 text-2xl font-bold hover:text-green-600">
  &#8592;
</button>
      <h1 class="text-lg font-bold text-white tracking-tight">Área de Depósito</h1>
      <a href="historicodeposito.html" class="text-sm text-white hover:underline">Ver extrato</a>
    </header>

    <!-- Tela de seleção de banco (inicial) -->
    <div id="bankSelectionScreen">
      <!-- Cartão do saldo -->
      <section class="px-5 mt-6">
        <div class="football-field text-white p-5 flex items-center justify-between">
          <div>
            <p class="text-sm opacity-90 mb-1">Saldo atual</p>
            <p class="text-2xl font-bold" id="userBalance">KZ 0,00</p>
          </div>
          <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center">
            <span class="text-green-600 font-bold text-lg">⚽</span>
          </div>
        </div>
      </section>

      <!-- Seletor de valores -->
      <section class="px-5 mt-8">
        <p class="text-sm font-medium text-green-800 mb-2">Selecione um valor rápido</p>
        <div class="grid grid-cols-3 gap-3">
          <button data-value="4000" class="grass-button text-sm font-semibold py-2 text-center">KZ 4.000</button>
          <button data-value="8000" class="grass-button text-sm font-semibold py-2 text-center">KZ 8.000</button>
          <button data-value="16000" class="grass-button text-sm font-semibold py-2 text-center">KZ 16.000</button>
          <button data-value="32000" class="grass-button text-sm font-semibold py-2 text-center">KZ 32.000</button>
          <button data-value="64000" class="grass-button text-sm font-semibold py-2 text-center">KZ 64.000</button>
          <button data-value="128000" class="grass-button text-sm font-semibold py-2 text-center">KZ 128.000</button>
        </div>
      </section>

      <!-- Formulário -->
      <section class="px-5 mt-6">
        <form id="depositForm" class="space-y-5">
          <div>
            <label for="valorInput" class="text-sm font-medium text-green-800 block mb-1">Outro valor</label>
            <div class="flex items-center bg-white border border-green-300 rounded-lg px-3 py-2">
              <span class="text-green-600 font-semibold mr-2">KZ</span>
              <input required name="amount" id="valorInput" type="number" class="w-full bg-transparent outline-none placeholder-green-400" placeholder="Digite um valor" value="" min="5000" />
            </div>
          </div>

          <div>
            <p class="text-sm font-medium text-green-800 mb-2">Escolha o banco para depósito</p>
            <div class="bank-info-grass cursor-pointer" onclick="openBankModal()">
              <div class="flex items-center">
                <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center mr-3">
                  <span class="text-green-600 font-bold">⚽</span>
                </div>
                <div class="bank-info">
                  <div class="bank-name font-medium" id="selectedBankName">Selecione o banco</div>
                  <div class="bank-desc text-green-100 text-sm" id="selectedBankDesc">Toque para escolher com as bolas de futebol</div>
                </div>
                <svg class="w-5 h-5 text-white ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </div>
            </div>
            <input type="hidden" id="bankCode" value="">
          </div>

          <button type="button" onclick="validateForm()" id="btnDepositar" class="w-full grass-button font-semibold py-3 shadow">Depositar agora</button>
        </form>

        <div class="mt-6 text-xs text-green-700 leading-relaxed space-y-3">
          <h2 class="text-sm font-bold">Informações de Recarga</h2>
          <div class="flex items-start gap-2">
            <div class="w-4 h-4 bg-green-500 rounded-full animate-pulse mt-1"></div>
            <p>O valor mínimo de recarga é de <strong>KZ 4.000</strong>.</p>
          </div>

          <div class="flex items-start gap-2">
            <div class="w-4 h-4 bg-yellow-500 rounded-full animate-bounce mt-1"></div>
            <p><strong>Você deve enviar uma nova solicitação de recarga para cada depósito</strong>.</p>
          </div>

          <div class="flex items-start gap-2">
            <div class="w-4 h-4 bg-white rounded-full animate-pulse mt-1"></div>
            <p><strong>Caso encontre algum problema durante o processo de recarga, entre em contato com o <a class="underline" href="https://t.me/+PbM_coC8sSUxOTQ0">Atendimento ao Cliente.</a></strong></p>
          </div>
        </div>
      </section>
    </div>

    <!-- Tela de informações bancárias (aparece após selecionar um banco) -->
    <div id="bankDetailsScreen" class="bank-details-screen px-5">
      <button class="back-button" onclick="goBackToSelection()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Voltar
      </button>

      <div class="football-field text-white">
        <h2 class="text-xl font-bold mb-4 text-center">Informações para Depósito</h2>
        
        <div class="bg-white bg-opacity-20 rounded-lg p-4 mb-3">
          <div class="flex justify-between items-center">
            <span class="font-medium">Banco Selecionado:</span>
            <span class="font-bold" id="detailBankName">-</span>
          </div>
        </div>
        
        <div class="bg-white bg-opacity-20 rounded-lg p-4 mb-3">
          <div class="flex justify-between items-center">
            <span class="font-medium">Nome do Beneficiário:</span>
            <span class="font-bold" id="detailBeneficiary">-</span>
          </div>
        </div>
        
        <div class="bg-white bg-opacity-20 rounded-lg p-4 mb-3">
          <div class="flex justify-between items-center">
            <span class="font-medium">Número da Conta (IBAN):</span>
            <div class="flex items-center">
              <span class="font-bold mr-2" id="detailIban">-</span>
              <button class="bg-white text-green-600 px-2 py-1 rounded text-xs font-bold" onclick="copyToClipboard('detailIban')">Copiar</button>
            </div>
          </div>
        </div>
        
        <div class="bg-white bg-opacity-20 rounded-lg p-4 mb-3">
          <div class="flex justify-between items-center">
            <span class="font-medium">Referência:</span>
            <div class="flex items-center">
              <span class="font-bold mr-2" id="detailReference">-</span>
              <button class="bg-white text-green-600 px-2 py-1 rounded text-xs font-bold" onclick="copyToClipboard('detailReference')">Copiar</button>
            </div>
          </div>
        </div>
        
        <div class="bg-white bg-opacity-20 rounded-lg p-4">
          <div class="flex justify-between items-center">
            <span class="font-medium">Valor do Depósito:</span>
            <span class="font-bold" id="detailAmount">-</span>
          </div>
        </div>
      </div>

      <div class="white-card mt-6">
        <h3 class="text-lg font-semibold text-green-800 mb-4">Enviar Comprovante</h3>
        
        <div class="receipt-upload-area border-green-300" onclick="openGallery()">
          <input type="file" id="receiptInput" accept="image/*" class="hidden" onchange="handleReceiptUpload(event)">
          <div class="flex flex-col items-center">
            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-2">
              <span class="text-green-600 text-xl">⚽</span>
            </div>
            <p class="text-green-700 font-medium">Clique para enviar o comprovante</p>
            <p class="text-green-600 text-sm mt-1">PNG, JPG (MAX. 5MB)</p>
          </div>
        </div>
        
        <img id="receiptPreview" class="receipt-preview">
        <p id="fileName" class="text-sm text-green-600 mt-2 text-center hidden"></p>
        
        <button id="submitDepositBtn" class="w-full grass-button font-semibold py-3 shadow mt-4" onclick="submitDeposit()" disabled>Confirmar Depósito</button>
      </div>
    </div>

    <!-- Modal de Seleção de Bancos com Bolas de Futebol -->
    <div id="bankModal" class="fixed inset-0 z-50 hidden items-center justify-center backdrop-blur-sm bg-black/40" onclick="closeBankModal(event)">
      <div onclick="event.stopPropagation()" class="football-field compact-modal">
        <div class="compact-modal-content">
          <div class="flex justify-between items-center border-b border-green-300 pb-3 mb-3">
            <h3 class="text-lg font-bold text-white">Selecione o Banco</h3>
            <button onclick="closeBankModal()" class="text-white hover:text-green-200 text-xl font-bold">×</button>
          </div>
          
          <div class="text-center mb-4">
            <p class="text-green-100">Escolha um banco tocando em uma bola de futebol</p>
          </div>
          
          <div class="football-container" id="footballContainer">
            <!-- As bolas de futebol serão inseridas aqui via JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center">
      <div class="football-field p-6 rounded-xl shadow-lg flex flex-col items-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-white mb-4"></div>
        <p class="text-white">Processando seu depósito...</p>
      </div>
    </div>
  </div>

  <!-- Menu de navegação com ícones de imagem -->
    <nav class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[500px] z-50 shadow-xl border-t border-green-100 rounded-t-2xl overflow-hidden">
      <ul class="flex justify-around items-center py-2 bg-gradient-to-r from-green-500 via-green-600 to-green-700 text-white text-xs">
        
        <li>
          <a href="principal.html" class="flex flex-col items-center gap-0.5 font-bold">
            <img src="img/home.png" alt="Início" class="w-6 h-6">
            <span>Início</span>
          </a>
        </li>
        
        <li>
          <a href="renda.html" class="flex flex-col items-center gap-0.5 opacity-80">
            <img src="img/produto.png" alt="Renda" class="w-6 h-6">
            <span>Renda</span>
          </a>
        </li>
        
        <li>
          <a href="equipe.html" class="flex flex-col items-center gap-0.5 opacity-80">
            <img src="img/equipe.png" alt="VIP" class="w-6 h-6">
            <span>VIP</span>
          </a>
        </li>
        
        <li>
          <a href="iban.html" class="flex flex-col items-center gap-0.5 opacity-80">
            <img src="img/fortuna.png" alt="Bancária" class="w-6 h-6">
            <span>Bancária</span>
          </a>
        </li>
        
        <li>
          <a href="dashboard.html" class="flex flex-col items-center gap-0.5 opacity-80">
            <img src="img/equipe.png" alt="Perfil" class="w-6 h-6">
            <span>Perfil</span>
          </a>
        </li>

      </ul>
    </nav>


  <script>
    // Configurações
    const API_BASE_URL = 'https://bd-p4q7.onrender.com';
    let depositData = {};
    let receiptFile = null;
    let selectedBank = '';
    let depositAmount = 0;

    // Informações dos bancos
    const bankInfo = {
      'BAI': {
        name: 'BAI',
        fullName: 'BAI - Banco Angolano de Investimentos',
        beneficiary: 'Maria',
        iban: '004000009649885610118',
        reference: 'Trony' + Math.floor(10000 + Math.random() * 90000)
      },
      'BFA': {
        name: 'BFA',
        fullName: 'BFA - Banco de Fomento Angola',
        beneficiary: 'Gomes',
        iban: '00060000984498413',
        reference: 'Tmfdgf' + Math.floor(10000 + Math.random() * 90000)
      },
      'BIC': {
        name: 'BIC',
        fullName: 'BIC - Banco Internacional de Crédito',
        beneficiary: 'Alexandre',
        iban: '005100007348498810127',
        reference: 'gfhgjgh' + Math.floor(10000 + Math.random() * 90000)
      },
      'ATL': {
        name: 'ATL',
        fullName: 'ATL - Banco Atlântico',
        beneficiary: 'Maria',
        iban: '005500002800024310142',
        reference: 'XXXXXX' + Math.floor(10000 + Math.random() * 90000)
      }
    };

    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
        if (!isTokenValid()) {
            window.location.href = '/index.html';
            return;
        }
        loadUserData();
        setupEventListeners();
    });

    // Configurar listeners
    function setupEventListeners() {
        // Selecionar valor rápido
        const depositButtons = document.querySelectorAll('.grass-button');
        const depositInput = document.getElementById('valorInput');

        depositButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove a seleção de todos os botões
                depositButtons.forEach(b => b.classList.remove('bg-green-800', 'text-white'));
                // Adiciona seleção ao botão clicado
                btn.classList.add('bg-green-800', 'text-white');
                depositInput.value = btn.dataset.value;
            });
        });
    }

    // Carregar dados do usuário
    async function loadUserData() {
        showLoading(true);
        try {
            const token = getToken();
            const response = await fetch(`${API_BASE_URL}/api/user/profile`, {
                headers: { 
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    const saldo = data.data.wallet_balance || 0;
                    document.getElementById('userBalance').textContent = `KZ ${saldo.toLocaleString('pt-AO')}`;
                }
            }
        } catch (error) {
            console.error('Erro ao carregar dados:', error);
            showError('Erro ao carregar dados do usuário');
        } finally {
            showLoading(false);
        }
    }

    // Abrir modal de seleção de bancos
    function openBankModal() {
        document.getElementById('bankModal').classList.remove('hidden');
        document.getElementById('bankModal').classList.add('flex');
        
        // Inicializar as bolas de futebol
        initFootballBalls();
    }

    // Fechar modal
    function closeBankModal(event) {
        const modal = document.getElementById("bankModal");
        if (!event || event.target.id === "bankModal") {
            modal.classList.add("hidden");
        }
    }

    // Inicializar as bolas de futebol
    function initFootballBalls() {
        const container = document.getElementById('footballContainer');
        container.innerHTML = '';
        
        const banks = ['BAI', 'BFA', 'BIC', 'ATL'];
        const radius = 120; // Raio do círculo
        const centerX = container.offsetWidth / 2;
        const centerY = container.offsetHeight / 2;
        
        // Posições iniciais aleatórias fora da tela
        banks.forEach((bankCode, index) => {
            const ball = document.createElement('div');
            ball.className = 'football-ball';
            ball.id = `ball-${bankCode}`;
            ball.dataset.bank = bankCode;
            
            const ballContent = document.createElement('div');
            ballContent.className = 'ball-content';
            ballContent.textContent = bankInfo[bankCode].name;
            ball.appendChild(ballContent);
            
            // Posição inicial aleatória fora da tela
            const startX = Math.random() * 100 - 50;
            const startY = Math.random() * 100 - 50;
            
            ball.style.left = `${startX}px`;
            ball.style.top = `${startY}px`;
            
            container.appendChild(ball);
            
            // Animação para mover a bola para sua posição no círculo
            setTimeout(() => {
                const angle = (index / banks.length) * 2 * Math.PI;
                const x = centerX + radius * Math.cos(angle) - 40; // -40 para centralizar a bola
                const y = centerY + radius * Math.sin(angle) - 40; // -40 para centralizar a bola
                
                ball.style.left = `${x}px`;
                ball.style.top = `${y}px`;
            }, 100 * index);
            
            // Adicionar evento de clique
            ball.addEventListener('click', () => selectFootballBall(bankCode));
        });
    }

    // Selecionar uma bola de futebol
    function selectFootballBall(bankCode) {
        selectedBank = bankCode;
        
        // Atualizar informações do banco selecionado
        document.getElementById('selectedBankName').textContent = bankInfo[bankCode].fullName;
        document.getElementById('selectedBankDesc').textContent = `Banco selecionado: ${bankInfo[bankCode].name}`;
        
        // Fechar o modal
        closeBankModal();
    }

    // Mostrar tela de informações bancárias
    function showBankDetails() {
        // Obter valor do depósito
        const valorInput = document.getElementById('valorInput');
        depositAmount = parseFloat(valorInput.value) || 0;
        
        // Validar valor
        if (!depositAmount || depositAmount < 4000) {
            showError('Por favor, insira um valor válido (mínimo KZ 4.000)');
            return;
        }
        
        // Atualizar informações na tela de detalhes
        document.getElementById('detailBankName').textContent = bankInfo[selectedBank].fullName;
        document.getElementById('detailBeneficiary').textContent = bankInfo[selectedBank].beneficiary;
        document.getElementById('detailIban').textContent = bankInfo[selectedBank].iban;
        document.getElementById('detailReference').textContent = bankInfo[selectedBank].reference;
        document.getElementById('detailAmount').textContent = `KZ ${depositAmount.toLocaleString('pt-AO')}`;
        
        // Mostrar tela de detalhes e esconder tela de seleção
        document.getElementById('bankSelectionScreen').style.display = 'none';
        document.getElementById('bankDetailsScreen').classList.remove('bank-details-screen');
    }

    // Voltar para a tela de seleção
    function goBackToSelection() {
        document.getElementById('bankDetailsScreen').classList.add('bank-details-screen');
        document.getElementById('bankSelectionScreen').style.display = 'block';
        receiptFile = null;
    }

    // Função para abrir a galeria
    function openGallery() {
        document.getElementById('receiptInput').click();
    }

    // Upload do comprovante
    function handleReceiptUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        // Validar tamanho (5MB máximo)
        if (file.size > 5 * 1024 * 1024) {
            showError('Arquivo muito grande. Máximo 5MB.');
            return;
        }

        // Validar tipo
        if (!file.type.match('image.*')) {
            showError('Por favor, selecione uma imagem (JPG, PNG).');
            return;
        }

        receiptFile = file;

        // Mostrar preview
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('receiptPreview');
            preview.src = e.target.result;
            preview.style.display = 'block';
            
            // Mostrar nome do arquivo
            const fileNameElement = document.getElementById('fileName');
            fileNameElement.textContent = `Arquivo selecionado: ${file.name}`;
            fileNameElement.classList.remove('hidden');
            
            // Habilitar botão de confirmação
            document.getElementById('submitDepositBtn').disabled = false;
        };
        reader.readAsDataURL(file);
        
        clearError();
    }

    // Validar formulário (na tela de seleção)
    function validateForm() {
        const valor = parseFloat(document.getElementById('valorInput').value);

        if (!valor || isNaN(valor) || valor < 4000) {
            showError('O valor mínimo para depósito é KZ 4.000');
            return;
        }

        if (!selectedBank) {
            showError('Selecione um banco para continuar');
            openBankModal();
            return;
        }

        // Se já tem um banco selecionado, ir direto para a tela de detalhes
        showBankDetails();
    }

    // Submeter depósito - EXATAMENTE COMO NO SEU CÓDIGO ORIGINAL
    async function submitDeposit() {
        if (!receiptFile) {
            showError('Por favor, envie o comprovante');
            return;
        }

        showLoading(true);

        try {
            const token = getToken();
            const formData = new FormData();
            formData.append('receipt', receiptFile);

            // Preparar dados do depósito
            const depositRequestData = {
                amount: depositAmount,
                account_name: bankInfo[selectedBank].beneficiary,
                iban: bankInfo[selectedBank].iban,
                bank_name: bankInfo[selectedBank].fullName,
                bank_code: selectedBank
            };

            // 1. Criar solicitação de depósito
            const depositResponse = await fetch(`${API_BASE_URL}/api/deposit`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(depositRequestData)
            });

            const depositResult = await depositResponse.json();

            if (!depositResult.success) {
                throw new Error(depositResult.message);
            }

            // 2. Upload do comprovante
            formData.append('deposit_id', depositResult.data.deposit_id);
            
            const uploadResponse = await fetch(`${API_BASE_URL}/api/upload/deposit-receipt`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                body: formData
            });

            const uploadResult = await uploadResponse.json();

            if (!uploadResult.success) {
                throw new Error(uploadResult.message);
            }

            // Sucesso
            showSuccess('Depósito solicitado com sucesso! Aguarde a confirmação.');
            
            // Redirecionar após 3 segundos
            setTimeout(() => {
                window.location.href = 'historicodeposito.html';
            }, 3000);

        } catch (error) {
            console.error('Erro ao processar depósito:', error);
            showError('Erro ao processar depósito: ' + error.message);
        } finally {
            showLoading(false);
        }
    }

    // Copiar para a área de transferência
    function copyToClipboard(elementId) {
        const element = document.getElementById(elementId);
        const text = element.textContent;
        
        navigator.clipboard.writeText(text).then(() => {
            showTemporaryMessage('Copiado para a área de transferência!');
       }).catch((err) => {
  console.error('Erro ao copiar:', err);
  // Fallback para método antigo
  const textArea = document.createElement('textarea');
  textArea.value = text;
  document.body.appendChild(textArea);
  textArea.select();
  document.execCommand('copy');
  document.body.removeChild(textArea);
  showTemporaryMessage('Copiado!');
});
} 

    // Funções auxiliares
    function showTemporaryMessage(message) {
        const msgDiv = document.createElement('div');
        msgDiv.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 10000;
            font-size: 14px;
            font-weight: 500;
        `;
        msgDiv.textContent = message;
        document.body.appendChild(msgDiv);
        
        setTimeout(() => {
            document.body.removeChild(msgDiv);
        }, 2000);
    }

    function showError(message) {
        alert(message); // Simples alert para erro
    }

    function showSuccess(message) {
        alert(message); // Simples alert para sucesso
    }

    function clearError() {
        // Limpar mensagens de erro se necessário
    }

    function showLoading(show) {
        const loading = document.getElementById('loading');
        if (show) {
            loading.classList.remove('hidden');
        } else {
            loading.classList.add('hidden');
        }
    }

    // Funções de autenticação
    function isTokenValid() {
        const tokenData = localStorage.getItem('user_token');
        if (!tokenData) return false;
        
        try {
            const { token, expiry } = JSON.parse(tokenData);
            return Date.now() < expiry;
        } catch (e) {
            return false;
        }
    }

    function getToken() {
        const tokenData = localStorage.getItem('user_token');
        if (!tokenData) return null;
        
        try {
            const { token } = JSON.parse(tokenData);
            return token;
        } catch (e) {
            return null;
        }
    }
  </script>
</body>
html>