<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Depósito</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/layui/2.6.8/css/layui.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/layui/2.6.8/layui.min.js"></script>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft YaHei", "PingFang SC", "Helvetica Neue", Arial, sans-serif;
            font-size: 16px;
            line-height: 1.5;
            color: #333;
            position: relative;
            min-height: 100vh;
            background: #c2ffdd !important;
            padding-bottom: 80px;
        }

        .navbar-top {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: linear-gradient(90deg, #28c76f 11.2%, #198754 78.9%) !important;
            color: white;
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 0 15px;
        }

        .navbar-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .nav-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 50%;
            transition: background-color 0.3s;
        }

        .nav-icon:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-title {
            font-size: 18px;
            font-weight: 500;
            text-align: center;
            flex: 1;
        }

        .app-capsule {
            padding-top: 56px;
            min-height: 100vh;
        }

        .content-area {
            padding: 12px;
        }

        .balance-card, .amount-card, .bank-card {
            background: rgba(255, 255, 255, 0.95) !important;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 3px 12px rgba(46, 125, 50, 0.12);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 208, 148, 0.2);
        }

        .balance-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .balance-amount {
            font-size: 22px;
            font-weight: 700;
            color: #198754;
        }

        .amount-title {
            font-size: 16px;
            color: #198754;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .amount-options {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 5px;
        }

        .amount-option {
            padding: 12px;
            min-width: 100px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .amount-option:hover, .amount-option.selected {
            border-color: #28c76f;
            background-color: rgba(40, 199, 111, 0.1);
        }

        .custom-amount {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .custom-amount:focus {
            border-color: #28c76f;
            outline: none;
        }

        .bank-options {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            margin-top: 15px;
            padding-bottom: 5px;
        }

        .bank-option {
            padding: 15px;
            min-width: 120px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .bank-option:hover, .bank-option.selected {
            border-color: #28c76f;
            background-color: rgba(40, 199, 111, 0.1);
        }

        .bank-icon {
            width: 50px;
            height: 50px;
            margin-bottom: 10px;
        }

        .bank-name {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .next-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(90deg, #28c76f 11.2%, #198754 78.9%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .next-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 199, 111, 0.4);
        }

        .next-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Estilos para a página de detalhes do banco */
        .bank-details {
            padding: 20px;
            text-align: center;
        }

        .bank-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
        }

        .detail-item {
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(25, 135, 84, 0.05);
            border-radius: 8px;
            border-left: 4px solid #198754;
        }

        .detail-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 16px;
            font-weight: 600;
            word-break: break-all;
        }

        .copy-button {
            background: #198754;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 5px;
        }

        .notice {
            margin-top: 20px;
            padding: 15px;
            background: #FFF3CD;
            border-radius: 8px;
            color: #856404;
            font-size: 14px;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .step {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e0e0e0;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 10px;
            position: relative;
        }

        .step.active {
            background-color: #28c76f;
            color: white;
        }

        .step.completed {
            background-color: #198754;
            color: white;
        }

        .step-line {
            position: absolute;
            height: 2px;
            width: 20px;
            background-color: #e0e0e0;
            top: 50%;
            transform: translateY(-50%);
        }

        .step-line.left {
            left: -20px;
        }

        .step-line.right {
            right: -20px;
        }

        .step-line.completed {
            background-color: #198754;
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        .deposit-info {
            background: #E8F5E9;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #2E7D32;
        }

        .upload-container {
            margin-top: 20px;
            text-align: center;
        }

        .upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background: #28c76f;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .preview-image {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            display: none;
        }

        @media (max-width: 768px) {
            .amount-options {
                grid-template-columns: 1fr;
            }
            
            .bank-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="navbar-top">
        <div class="navbar-content">
            <div class="nav-icon" id="backButton">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
            </div>
            <div class="nav-title" id="pageTitle">Depósito</div>
            <div class="nav-icon" style="visibility: hidden;">
                <!-- Espaço vazio para alinhamento -->
            </div>
        </div>
    </div>

    <div class="app-capsule">
        <div class="content-area" id="mainContent">
            <!-- Conteúdo será carregado dinamicamente -->
        </div>
    </div>

    <script>
    $(document).ready(function() {
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = 'index.html';
            return;
        }

        // Elementos da página
        const $mainContent = $('#mainContent');
        const $backButton = $('#backButton');
        const $pageTitle = $('#pageTitle');

        // Variáveis de estado
        let selectedAmount = 0;
        let selectedBank = '';
        let userBalance = 0;
        let depositAmount = 0;
        let currentStep = 1;
        const totalSteps = 3;
        let depositImage = null;
        let depositReference = '';

        // Bancos disponíveis
        const banks = [
            { id: 'BFA', name: 'Banco de Fomento Angola', icon: 'BFA' },
            { id: 'BAI', name: 'Banco Angolano de Investimentos', icon: 'BAI' },
            { id: 'BIC', name: 'Banco BIC', icon: 'BIC' },
            { id: 'ATL', name: 'Banco Atlântico', icon: 'ATL' }
        ];

        // Valores pré-definidos
        const amountOptions = [6000, 15000, 35000, 50000, 70000, 130000, 200000, 300000, 600000, 1200000];

        // Carrega o saldo do usuário
        async function loadBalance() {
            try {
                const response = await fetch('https://bd-1-tile.onrender.com/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar saldo');
                }
                
                const data = await response.json();
                userBalance = data.saldo || 0;
                
            } catch (error) {
                console.error('Erro:', error);
                layer.msg(error.message, {icon: 2});
            }
        }

        // Renderiza o indicador de etapas
        function renderStepIndicator() {
            let stepsHtml = '';
            
            for (let i = 1; i <= totalSteps; i++) {
                const isActive = i === currentStep;
                const isCompleted = i < currentStep;
                
                stepsHtml += `
                    <div class="step ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''}">
                        ${i}
                        ${i > 1 ? `<div class="step-line left ${i <= currentStep ? 'completed' : ''}"></div>` : ''}
                        ${i < totalSteps ? `<div class="step-line right ${i < currentStep ? 'completed' : ''}"></div>` : ''}
                    </div>
                `;
            }
            
            return `
                <div class="step-indicator">
                    ${stepsHtml}
                </div>
            `;
        }

        // Mostra a etapa atual
        function showCurrentStep() {
            $('.step-content').removeClass('active');
            $(`#step-${currentStep}`).addClass('active');
            
            // Atualiza o botão
            if (currentStep === totalSteps) {
                $('#nextStepButton').text('Confirmar Depósito');
            } else {
                $('#nextStepButton').text('Próximo');
            }
            
            // Verifica se pode avançar
            checkNextButton();
        }

        // Mostra a página inicial de depósito
        async function showDepositPage() {
            await loadBalance();
            
            $pageTitle.text('Depósito');
            
            $mainContent.html(`
                ${renderStepIndicator()}
                
                <div class="balance-card">
                    <div class="balance-title">Saldo atual</div>
                    <div class="balance-amount">KZ ${userBalance.toFixed(2)}</div>
                </div>
                
                <div id="step-1" class="step-content ${currentStep === 1 ? 'active' : ''}">
                    <div class="deposit-info">
                        <strong>Horário de depósito:</strong> 8h às 22h, de segunda a domingo<br>
                        <strong>Depósito mínimo:</strong> KZ 6.000,00
                    </div>
                    
                    <div class="amount-card">
                        <div class="amount-title">Selecione o valor do depósito</div>
                        
                        <div class="amount-options">
                            ${amountOptions.map(amount => `
                                <div class="amount-option" data-amount="${amount}">
                                    KZ ${amount.toLocaleString()}
                                </div>
                            `).join('')}
                        </div>
                        
                        <input type="number" class="custom-amount" id="customAmount" placeholder="Ou digite um valor personalizado (mínimo KZ 6.000)">
                    </div>
                </div>
                
                <div id="step-2" class="step-content ${currentStep === 2 ? 'active' : ''}">
                    <div class="bank-card">
                        <div class="amount-title">Selecione o banco</div>
                        
                        <div class="bank-options">
                            ${banks.map(bank => `
                                <div class="bank-option" data-bank="${bank.id}">
                                    <svg class="bank-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#198754">
                                        <path d="M5 14h14v2H5zm0-4h14v2H5zm7-8c3.309 0 6 2.691 6 6s-2.691 6-6 6-6-2.691-6-6 2.691-6 6-6zm0 2c-2.206 0-4 1.794-4 4s1.794 4 4 4 4-1.794 4-4-1.794-4-4-4z"/>
                                    </svg>
                                    <div class="bank-name">${bank.name}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <div id="step-3" class="step-content ${currentStep === 3 ? 'active' : ''}">
                    <div class="bank-details" id="bankDetailsContent">
                        <!-- Conteúdo será preenchido dinamicamente -->
                    </div>
                    
                    <div class="upload-container">
                        <div class="amount-title">Envie o comprovante de depósito</div>
                        <input type="file" id="depositProof" accept="image/*" style="display: none;">
                        <label for="depositProof" class="upload-btn">Selecionar Imagem</label>
                        <img id="previewImage" class="preview-image" alt="Pré-visualização do comprovante">
                    </div>
                </div>
                
                <button class="next-button" id="nextStepButton" disabled>Próximo</button>
            `);
            
            // Eventos
            $('.amount-option').click(function() {
                $('.amount-option').removeClass('selected');
                $(this).addClass('selected');
                selectedAmount = parseInt($(this).data('amount'));
                $('#customAmount').val(selectedAmount);
                checkNextButton();
            });
            
            $('#customAmount').on('input', function() {
                $('.amount-option').removeClass('selected');
                selectedAmount = parseInt($(this).val()) || 0;
                checkNextButton();
            });
            
            $('.bank-option').click(function() {
                $('.bank-option').removeClass('selected');
                $(this).addClass('selected');
                selectedBank = $(this).data('bank');
                checkNextButton();
            });
            
            $('#nextStepButton').click(async function() {
                if (currentStep < totalSteps) {
                    // Avança para a próxima etapa
                    currentStep++;
                    renderStepIndicator();
                    showCurrentStep();
                    
                    // Se chegou na etapa 3, carrega os detalhes do banco
                    if (currentStep === 3) {
                        await loadBankDetails();
                    }
                } else {
                    // Finaliza o processo
                    await submitDeposit();
                }
            });
            
            // Evento para upload da imagem
            $('#depositProof').change(function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        $('#previewImage').attr('src', event.target.result).show();
                        depositImage = file;
                        checkNextButton();
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // Carrega os detalhes do banco
        async function loadBankDetails() {
            if (selectedAmount <= 0 || !selectedBank) return;
            
            // Verifica se o valor é menor que o mínimo
            if (selectedAmount < 6000) {
                layer.msg('O valor mínimo para depósito é KZ 6.000,00', {icon: 2});
                currentStep--;
                showCurrentStep();
                return;
            }
            
            // Gera um valor aleatório com centavos
            const randomCents = Math.floor(Math.random() * 99) + 1;
            depositAmount = parseFloat(`${selectedAmount}.${randomCents.toString().padStart(2, '0')}`);
            
            // Gera uma referência única para o depósito
            depositReference = 'DEP-' + Date.now() + '-' + Math.floor(Math.random() * 1000);
            
            // Verifica com o backend se o valor está disponível
            try {
                const response = await fetch('https://bd-1-tile.onrender.com/deposit/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        amount: selectedAmount,
                        bank: selectedBank
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.msg || 'Erro ao gerar depósito');
                }
                
                // Atualiza o valor com o que o backend retornou (pode ter sido ajustado)
                depositAmount = data.finalAmount;
                
                // Mostra os detalhes do banco
                showBankDetails(data.bankDetails, depositAmount);
                
            } catch (error) {
                console.error('Erro:', error);
                layer.msg(error.message, {icon: 2});
                // Volta para a etapa anterior em caso de erro
                currentStep--;
                showCurrentStep();
            }
        }

        // Mostra os detalhes do banco
        function showBankDetails(bankDetails, amount) {
            $('#bankDetailsContent').html(`
                <svg class="bank-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#198754">
                    <path d="M5 14h14v2H5zm0-4h14v2H5zm7-8c3.309 0 6 2.691 6 6s-2.691 6-6 6-6-2.691-6-6 2.691-6 6-6zm0 2c-2.206 0-4 1.794-4 4s1.794 4 4 4 4-1.794 4-4-1.794-4-4-4z"/>
                </svg>
                
                <h2>${bankDetails.bankName}</h2>
                
                <div class="detail-item">
                    <div class="detail-label">Nome do Titular</div>
                    <div class="detail-value">${bankDetails.accountName}</div>
                    <button class="copy-button" data-text="${bankDetails.accountName}">Copiar</button>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">Número da Conta (IBAN)</div>
                    <div class="detail-value">${bankDetails.iban}</div>
                    <button class="copy-button" data-text="${bankDetails.iban}">Copiar</button>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">Valor exato para transferir</div>
                    <div class="detail-value">KZ ${amount.toFixed(2)}</div>
                    <button class="copy-button" data-text="${amount.toFixed(2)}">Copiar</button>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">Referência do Depósito</div>
                    <div class="detail-value">${depositReference}</div>
                    <button class="copy-button" data-text="${depositReference}">Copiar</button>
                </div>
                
                <div class="notice">
                    <strong>Atenção:</strong> Certifique-se de enviar exatamente <strong>KZ ${amount.toFixed(2)}</strong>.
                    O valor será creditado em sua conta dentro de 10 minutos após a confirmação.
                </div>
            `);
            
            // Eventos
            $('.copy-button').click(function() {
                const text = $(this).data('text');
                navigator.clipboard.writeText(text);
                layer.msg('Copiado!', {icon: 1});
            });
        }

        // Verifica se pode habilitar o botão de avançar
        function checkNextButton() {
            let canProceed = false;
            
            if (currentStep === 1) {
                canProceed = selectedAmount >= 6000; // Mínimo de 6000
            } else if (currentStep === 2) {
                canProceed = selectedBank !== '';
            } else if (currentStep === 3) {
                canProceed = depositImage !== null;
            }
            
            $('#nextStepButton').prop('disabled', !canProceed);
        }

        // Envia o depósito para o servidor
         // Envia o depósito para o servidor
        async function submitDeposit() {
            if (!depositImage) {
                layer.msg('Por favor, envie o comprovante de depósito', {icon: 2});
                return;
            }
            
            const loading = layer.msg('Processando depósito...', {icon: 16, shade: 0.3, time: 0});
            
            try {
                // 1. Primeiro envia para a API antiga (formato JSON)
                const oldApiResponse = await fetch('https://bd-1-tile.onrender.com/deposit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        amount: depositAmount,
                        bank: selectedBank,
                        reference: depositReference
                    })
                });
                
                if (!oldApiResponse.ok) {
                    throw new Error('Erro ao registrar depósito na API principal');
                }
                
                // 2. Depois envia para a nova API (com a imagem)
                const formData = new FormData();
                formData.append('valor', depositAmount);
                formData.append('banco', selectedBank);
                formData.append('referencia', depositReference);
                formData.append('comprovante', depositImage);
                
                // Adiciona outros dados do usuário que a API pode precisar
                const userData = await getUserData();
                if (userData) {
                    formData.append('nome', userData.nome || '');
                    formData.append('telefone', userData.telefone || '');
                    formData.append('email', userData.email || '');
                }
                
                const newApiResponse = await fetch('https://api-wped.onrender.com/depositos', {
                    method: 'POST',
                    body: formData
                    // Não definir Content-Type, o browser fará isso automaticamente com o boundary
                });
                
                if (!newApiResponse.ok) {
                    console.error('Detalhes do erro na nova API:', await newApiResponse.text());
                    throw new Error('Erro ao enviar comprovante, mas o depósito foi registrado');
                }
                
                layer.close(loading);
                layer.msg('Depósito enviado com sucesso!', {icon: 1}, function() {
                    window.location.href = 'index.html';
                });
                
            } catch (error) {
                layer.close(loading);
                console.error('Erro completo:', error);
                
                // Mostra mensagem diferente dependendo do erro
                if (error.message.includes('API principal')) {
                    layer.msg('Erro no sistema. Por favor, tente novamente mais tarde.', {icon: 2});
                } else {
                    layer.msg('Depósito registrado! O comprovante pode não ter sido enviado. Entre em contato com o suporte.', {icon: 1});
                }
            }
        }

        // Função auxiliar para obter dados do usuário
        async function getUserData() {
            try {
                const response = await fetch('https://bd-1-tile.onrender.com/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                return await response.json();
            } catch (error) {
                console.error('Erro ao obter dados do usuário:', error);
                return null;
            }
        }

 // Envia o depósito para o servidor
        async function submitDeposit() {
            if (!depositImage) {
                layer.msg('Por favor, envie o comprovante de depósito', {icon: 2});
                return;
            }
            
            const loading = layer.msg('Processando depósito...', {icon: 16, shade: 0.3, time: 0});
            
            try {
                // 1. Primeiro envia para a API antiga (formato JSON)
                const oldApiResponse = await fetch('https://bd-1-tile.onrender.com/deposit/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        amount: depositAmount,
                        bank: selectedBank,
                        reference: depositReference
                    })
                });
                
                if (!oldApiResponse.ok) {
                    throw new Error('Erro ao registrar depósito na API principal');
                }
                
                // 2. Prepara os dados para a nova API (formato JSON com base64)
                const userData = await getUserData();
                const imageBase64 = await convertImageToBase64(depositImage);
                
                const depositData = {
                    valor: depositAmount,
                    banco: selectedBank,
                    referencia: depositReference,
                    comprovante: imageBase64,
                    usuario: {
                        nome: userData?.nome || '',
                        telefone: userData?.telefone || '',
                        email: userData?.email || ''
                    }
                };
                
                // 3. Envia para a nova API
                const newApiResponse = await fetch('https://api-wped.onrender.com/depositos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(depositData)
                });
                
                if (!newApiResponse.ok) {
                    console.error('Detalhes do erro na nova API:', await newApiResponse.text());
                    throw new Error('Erro ao enviar comprovante, mas o depósito foi registrado');
                }
                
                layer.close(loading);
                layer.msg('Depósito enviado com sucesso!', {icon: 1}, function() {
                    window.location.href = 'index.html';
                });
                
            } catch (error) {
                layer.close(loading);
                console.error('Erro completo:', error);
                
                // Mostra mensagem diferente dependendo do erro
                if (error.message.includes('API principal')) {
                    layer.msg('Erro no sistema. Por favor, tente novamente mais tarde.', {icon: 2});
                } else {
                    layer.msg('Depósito registrado! O comprovante pode não ter sido enviado. Entre em contato com o suporte.', {icon: 1});
                }
            }
        }

        // Converte a imagem para base64
        function convertImageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    // Remove o prefixo (data:image/jpeg;base64,) se existir
                    const base64String = reader.result.split(',')[1] || reader.result;
                    resolve(base64String);
                };
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }
        // Botão de voltar
        $backButton.click(function() {
            if (currentStep > 1) {
                currentStep--;
                renderStepIndicator();
                showCurrentStep();
            } else {
                window.history.back();
            }
        });

        // Inicializa a página
        showDepositPage();
    });
    </script>
</body>
</html>